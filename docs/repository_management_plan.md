# 今後のリポジトリ管理方針について

Next.jsでの本番実装への移行に伴い、今後の開発効率、コードの保守性、および情報セキュリティを考慮したリポジトリ管理方針を以下のように提案します。

## 基本方針

現行のデモリポジトリと、Next.jsで実装する本番用リポジトリを分離して管理します。

### 1. 現行リポジトリ (`nico_demo`) — 契約前段階まで＋契約書類の保管庫

- **役割:**
    - デモサイトの最終版コード保管
    - **契約前・決定前**の記録：企画段階の議事録、提案資料、検討資料のアーカイブ
    - **契約書・更新契約のPDF**：最低限このリポジトリの `docs` に保管する（引き継ぎ時に「経緯と契約はここ」と一箇所で揃える）
- **管理方法:**
    - 今後の開発は行わず、原則として**アーカイブ（凍結）**とします。
    - `main`ブランチを保護し、誤った変更が加わらないように設定することを推奨します。
    - リポジトリ自体をプライベート設定にすることもご検討ください。

### 2. 新規リポジトリ (例: `nico_site_production`) — 引継ぎで大事なこと

- **役割:**
    - Next.jsによる本番サイトのソースコード管理
    - 本番環境に特化した技術ドキュメント（インフラ構成、デプロイ手順など）の管理
    - 本番サイトの仕様に関する最新のドキュメント（`spec`ディレクトリ配下のファイルなど）の管理
    - **引き継ぎ用**：誰が何をするか・どう動かすかなど、運用に必要な大事なこと。契約書・経緯の詳細は「現行リポジトリの `docs` を参照」とREADMEに一行書いておく
- **管理方法:**
    - Next.jsのプロジェクトとして新規にセットアップします。
    - Git-flowやGitHub Flowなどのブランチ戦略を導入し、体系的な開発プロセスを構築します。
    - こちらのリポジトリは開発が活発に行われる場所となります。

## ドキュメントの移行について

現行リポジトリの`docs`配下にあるドキュメントのうち、本番実装でも参照・更新される以下のファイル群は、新規リポジトリに移行します。

- **移行対象のファイル:**
    - `docs/spec/concept.md`
    - `docs/spec/nextjs.md`
    - `docs/spec/reference_sites.md`
    - `docs/spec/sitemap.md`
    - `docs/spec/spec.md`
    - `docs/proposals/0906/要件定義兼見積書.md`

その他の過去の提案資料や議事録は、開発経緯の記録として現行リポジトリに残します。

## この方針のメリット

- **クリーンなコミット履歴:** 本番リポジトリの履歴がNext.jsでの開発に特化するため、コードの変更追跡や管理が容易になります。
- **関心の分離:** デモ開発の経緯と本番開発のコードが明確に分離され、プロジェクトの見通しが良くなります。
- **セキュリティ向上:** 契約書などの機密情報は現行リポジトリ（Private推奨）にのみ置き、新リポジトリには置かないため、開発用リポジトリから分離され誤公開のリスクを低減できます。

## 契約書・PDFの置き場所（方針）

- **契約書・更新契約のPDF**は**最低限このリポジトリ（`nico_demo`）の `docs` に入れておく**。
- 置き場の例：`docs/contacts/proposals/` の日付フォルダ内、または `docs/contracts/` を新設して `契約書.pdf`・`更新契約_YYYYMM.pdf` などで管理。
- 新リポジトリには契約書は移さない（コードと混在させない）。引き継ぐ相手には「契約書類は nico_demo の docs を参照」と案内する。

上記の方針で進めさせていただきたく思います。ご確認のほど、よろしくお願いいたします。

## 運用ルール（概要）

- ブランチ戦略: GitHub Flow（`main`は保護。直push禁止、必須レビュー1、CI必須）
- 権限: 本番リポジトリはPrivate。外部共有はReleasesの成果物のみ
- PR: 小さく分割、CIグリーンでマージ。大きいPRは分割
- 秘密情報: `.env`はコミット禁止。GitHub Secretsで管理
- リリース: タグ `vX.Y.Z`、`CHANGELOG.md`更新必須
- 緊急対応: `hotfix/*` → レビュー後に`main`へ
- ドキュメント更新: 本方針の変更はPR提出→オーナー承認

## 移行実施の簡易チェックリスト

1. 新規リポジトリを作成し、Next.jsを初期化する
2. `main`保護ルールを設定（直push禁止、必須レビュー、CI必須）
3. CI/CDを設定（`main`で本番、PRでプレビュー環境）
4. 秘密情報をGitHub Secretsへ登録
5. 移行対象ドキュメントを移動し、関連リンクを更新
6. ステークホルダーに新ルールとリポジトリURLを周知
7. 旧リポジトリをアーカイブ（READMEで誘導、Release作成、Archive設定）

## GitHub リポジトリの説明文（Description）

リポジトリの「About」欄に設定すると役割が一目で分かります。

| リポジトリ | 説明文（コピー用） |
|-----------|-------------------|
| **nico_demo** | デモ・契約前段階の記録と契約書類の保管。本番は別リポジトリ。 |
| **新リポジトリ**（例: nico_site_production） | ニコ酒店 本番サイト（Next.js）。開発・デプロイはこちら。契約書類は nico_demo を参照。 |

---

## リポジトリの責任者

- 旧リポジトリ（`nico_demo`）オーナー: 記入欄
- 新規リポジトリ（例: `nico_site_production`）オーナー: 記入欄

## 補足（移行対象の再確認）

- `docs/proposals/0906/要件定義兼見積書.md`は本番でも更新する場合のみ移行。更新しない場合は現行リポジトリに残します。

## アーカイブ（凍結）設定とは

旧リポジトリを「読み取り専用」にして、誤って変更や公開をしないようにする状態を指します。GitHubの「Archive this repository」を使うと、基本的に新しいIssue/PRやPushができなくなり、参照だけができるようになります（必要になれば解除可能）。

## アーカイブ（凍結）の具体手順

1. 最終スナップショットを作成
    - Releaseを作成（例: `v1.0.0-final`）し、現状をタグとして固定します。
2. READMEの案内を更新
    - 冒頭に「本番用リポジトリのURL」「今後の更新場所」「問い合わせ先」を明記します。
3. ブランチ保護の再確認（凍結前）
    - `main`直push禁止、必須レビュー、CI必須を設定して、移行中の誤操作を防ぎます。
4. GitHubでアーカイブ設定
    - GitHub → `Settings` → `General` → 一番下の`Danger Zone` → `Archive this repository` を実行します。
5. オプションの整理
    - Issues/Wiki/Projectsなどを閉じ、説明文に「アーカイブ済み・参照専用」を追記します。

## 凍結後にできること・できないこと

- できること: 閲覧、クローン、フォーク、過去履歴の参照
- できないこと: 新しいIssueやPRの作成、Push、マージ、（多くの）設定変更
- 注意点: 変更が必要になった場合は、一時的に「Unarchive」してから対応します。

## 凍結解除（Unarchive）

- GitHub → `Settings` → `General` → `Unarchive this repository` で解除できます。
- 解除後も`main`の保護（直push禁止、レビュー必須、CI必須）は維持し、誤操作を防ぎます。
