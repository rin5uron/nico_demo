# nico-demo Next.js 移行計画書

このドキュメントは、nico-demo（静的デモサイト）を Next.js 本番サイトへ移行するための全体計画をまとめたものです。
以前は `プロジェクトサマリー.md`、`移行用リポジトリ.md`、`repository_management_plan.md`、`spec/nextjs.md` に分散していた内容を、ここに集約しています。

---

## 目次

1. [プロジェクト概要](#1-プロジェクト概要)
2. [移行の全体像](#2-移行の全体像)
3. [リポジトリ管理方針](#3-リポジトリ管理方針)
4. [Next.js 技術設計](#4-nextjs-技術設計)
5. [移行実施手順](#5-移行実施手順)
6. [移行後の運用](#6-移行後の運用)

---

## 1. プロジェクト概要

### 1.1 プロジェクトのゴール

ニコ酒店の公式ウェブサイトを構築し、オンラインでの情報発信とブランドイメージ向上を図る。将来的にはEC機能の実装も視野に入れる。

### 1.2 現在のフェーズ

- **静的デモサイト**（HTML/CSS/JavaScript）の制作が完了し、クライアントからの承認を得た段階
- これより、**本番実装フェーズ**へ移行する

### 1.3 完成済みの成果物

| 種類 | 場所 |
|------|------|
| 静的デモサイト | `index.html` および `site/` ディレクトリ配下 |
| 要件定義書 | `docs/proposals/0906/要件定義兼見積書.md` |
| サイト仕様書 | `docs/spec/` ディレクトリ配下 |
| その他 | `docs/` 配下の議事録・提案資料 |

### 1.4 決定済みの技術スタック

- **フロントエンドフレームワーク:** Next.js
- **ホスティング環境:** 提案済み（`docs/proposals/0906/ホスティングサービス提案書.pdf`）。最終決定は別途行う。

---

## 2. 移行の全体像

```
nico_demo（現行）                   新規リポジトリ（例: nico_site_production）
┌─────────────────────┐             ┌─────────────────────┐
│ 静的デモ（HTML/CSS） │  ────────► │ Next.js 本番サイト   │
│ 契約書類の保管       │  移行      │ 開発・デプロイ       │
│ アーカイブ（凍結）   │             │ 活発な開発          │
└─────────────────────┘             └─────────────────────┘
```

- **nico_demo**: デモの最終版・契約書類・経緯を保管。移行後はアーカイブ（読み取り専用）にする
- **新規リポジトリ**: Next.js の本番コードを管理。今後の開発はすべてこちらで行う

---

## 3. リポジトリ管理方針

### 3.1 役割の違い（一覧）

| 項目 | nico_demo（このリポ） | 移行用リポジトリ（新規） |
|------|------------------------|--------------------------|
| 役割 | デモ・契約前段階の記録・契約書類の保管 | 本番コード・開発・デプロイ |
| 契約書PDF | ✅ ここに保管 | ❌ 置かない（nico_demo を参照） |
| コード | 静的デモの最終版 | Next.js 本番 |
| 開発 | 行わない（凍結） | 活発に行う |

### 3.2 nico_demo（現行リポジトリ）の扱い

- **役割:**
  - デモサイトの最終版コード保管
  - 契約前・決定前の記録（企画段階の議事録、提案資料、検討資料のアーカイブ）
  - **契約書・更新契約のPDF**：`docs/contacts/proposals/` の日付フォルダ内、または `docs/contracts/` に保管
- **管理方法:**
  - 移行後は原則として**アーカイブ（凍結）**
  - `main` ブランチを保護し、誤った変更を防ぐ
  - リポジトリは Private 推奨

### 3.3 新規リポジトリ（例: nico_site_production）の作成

**リポジトリ名の例:**

- `nico_site_production`
- または任意の名前（例: `nico-nextjs`, `midorino-tatemono-site`）

**GitHub で作成するとき:**

1. **New repository** でリポジトリを作成（Private 推奨）
2. **Description（About）** に以下を入れる：
   ```
   ニコ酒店 本番サイト（Next.js）。開発・デプロイはこちら。契約書類は nico_demo を参照。
   ```
3. **README** は、nico_demo 内の `docs/README_NEW_REPO_TEMPLATE.md` の内容をコピーして使う（存在する場合）

**新リポジトリの役割:**

- Next.js による本番サイトのソースコード管理
- 本番環境に特化した技術ドキュメント（インフラ構成、デプロイ手順など）
- 本番サイト仕様の最新ドキュメント（`spec` ディレクトリ配下）
- 引き継ぎ用：「契約書・経緯の詳細は nico_demo の docs を参照」と README に記載

### 3.4 ドキュメントの移行対象

新規リポジトリに移行するドキュメント：

| ファイル | 用途 |
|----------|------|
| `docs/spec/concept.md` | コンセプト |
| `docs/spec/nextjs.md` | Next.js 設計（本計画書に統合済み） |
| `docs/spec/reference_sites.md` | 参考サイト |
| `docs/spec/sitemap.md` | サイトマップ |
| `docs/spec/spec.md` | サイト仕様 |
| `docs/proposals/0906/要件定義兼見積書.md` | 要件定義（本番でも更新する場合のみ移行） |

その他の過去の提案資料や議事録は、nico_demo に残す。

### 3.5 GitHub リポジトリの説明文（Description）

| リポジトリ | 説明文（コピー用） |
|-----------|-------------------|
| **nico_demo** | デモ・契約前段階の記録と契約書類の保管。本番は別リポジトリ。 |
| **新リポジトリ** | ニコ酒店 本番サイト（Next.js）。開発・デプロイはこちら。契約書類は nico_demo を参照。 |

---

## 4. Next.js 技術設計

### 4.1 基本方針

- **App Router の採用**: Next.js の App Router を利用し、`app` ディレクトリベースのルーティングとコンポーネント管理を行う
- **コンポーネントベース設計**: 既存の HTML を再利用可能な React コンポーネントに分割し、コードの保守性と可読性を向上させる
- **CSS Modules**: スタイルの競合を防ぐため、コンポーネントごとにスコープされた CSS（CSS Modules）を基本とする。共通スタイルはグローバル CSS で管理
- **画像最適化**: Next.js の `<Image>` コンポーネントを利用し、画像の自動最適化（リサイズ、WebP 変換など）を行う
- **静的サイト生成 (SSG)**: 更新頻度が低いページは静的に生成し、高速な表示を実現

### 4.2 プロジェクト構造（案）

```
/
├── /app/                     # 主なアプリケーションコード
│   ├── /_components/         # サイト全体で使う共通コンポーネント
│   │   ├── Header.tsx
│   │   ├── Footer.tsx
│   │   └── SectionTitle.tsx
│   ├── page.tsx              # トップページ (旧 index.html)
│   ├── layout.tsx            # 全ページ共通のレイアウト (<html>, <body>)
│   └── globals.css           # グローバルCSS (旧 style.css の一部)
│
├── /components/              # 特定のページや機能で使うコンポーネント
│   ├── HeroSection.tsx
│   ├── NewsSection.tsx
│   ├── ConceptSection.tsx
│   ├── ProductsSection.tsx
│   └── ContactSection.tsx
│
├── /public/                  # 静的ファイル (画像など)
│   ├── /images/
│   │   ├── logo.jpg
│   │   └── ... (既存の画像をすべてここに移動)
│   └── /icons/
│       └── ... (既存のアイコンをすべてここに移動)
│
└── package.json              # プロジェクト設定
```

### 4.3 コンポーネント分割計画

`index.html` を以下の React コンポーネントに分割する。

| コンポーネント名 | 対応するHTML要素/セクション | 役割・機能 |
| :--- | :--- | :--- |
| `Header` | `<header>` | ヘッダー、ナビゲーション、SNSリンク。モバイルメニューの開閉状態を `useState` で管理。 |
| `Footer` | `<footer>` | フッター、コピーライト表示。 |
| `HeroSection` | `<section class="main-visual">` | メインビジュアルとキャッチコピー。 |
| `NewsSection` | `<section class="news-instagram">` | お知らせ（カレンダーとInstagram埋め込み）。 |
| `ConceptSection` | `<section id="store-concept">` | 「お店について」のセクション。 |
| `ProductsSection` | `<section id="product">` | 取扱商品セクション。薬膳茶や各種サンプル表示を含む。Swiper.js 部分はクライアントコンポーネント（`"use client"`）として実装。 |
| `ContactSection` | `<section id="contact">` | お問い合わせ情報と Google Map。 |
| `SectionTitle` | `<div class="section-title">` | 各セクションで共通して使われるタイトル部分をコンポーネント化。 |

### 4.4 ファイル移行計画

| 種類 | 移行内容 |
|------|----------|
| **HTML (`index.html`)** | 内容は `app/page.tsx` と上記コンポーネントに分割して JSX として記述。`lang="ja"` は `app/layout.tsx` の `<html>` に設定。`<title>` や `<meta>` は `metadata` オブジェクトで管理。Google Fonts は `next/font` で最適化。 |
| **CSS (`site/style.css`)** | `globals.css`: `:root` の CSS 変数や `body`, `a` など全体スタイルを `app/globals.css` に移行。各コンポーネントのスタイルは `[ComponentName].module.css` として CSS Modules で管理。 |
| **JavaScript (`site/script.js`)** | モバイルメニュー: `Header` 内で `useState` で管理。スクロールアニメーション: `"use client"` + `useEffect` で実装。Swiper.js: `ProductsSection` をクライアントコンポーネントとし、`useEffect` で初期化。Instagram 埋め込み: Next.js の `<Script>` で読み込み。 |
| **画像** | `site/images/`, `docs/media/` の画像を `public/images/` に集約。`<img>` は `<Image>` コンポーネントに置き換え。 |

---

## 5. 移行実施手順

### 5.1 フェーズ1: リポジトリ・プロジェクト準備

| # | タスク | 詳細 |
|---|--------|------|
| 1 | 新規リポジトリ作成 | GitHub で新リポジトリを作成（Private 推奨）。Description を設定。 |
| 2 | Next.js プロジェクト作成 | 下記コマンドで初期化する |
| 3 | `main` 保護ルール設定 | 直 push 禁止、必須レビュー 1、CI 必須 |
| 4 | CI/CD 設定 | `main` で本番、PR でプレビュー環境 |
| 5 | 秘密情報の管理 | `.env` はコミット禁止。GitHub Secrets で管理 |

**Next.js プロジェクト作成コマンド:**

```bash
npx create-next-app@latest nico-next-app --typescript --tailwind no --eslint yes --app yes --src-dir no --import-alias "@/*"
```

### 5.2 フェーズ2: 資産の移行

| # | タスク | 詳細 |
|---|--------|------|
| 1 | 画像ファイルのコピー | `site/images/`, `docs/media/` の画像を `public/images/` にコピー |
| 2 | ドキュメントの移行 | 移行対象の `docs/spec/` ファイルを新リポジトリにコピー |
| 3 | 共通スタイルの移行 | `app/globals.css` に共通スタイルをコピー |

### 5.3 フェーズ3: 実装

| # | タスク | 詳細 |
|---|--------|------|
| 1 | レイアウト作成 (`app/layout.tsx`) | `Header` と `Footer` の枠を作成し配置。`metadata` を設定。Google Fonts を読み込み。 |
| 2 | トップページ作成 (`app/page.tsx`) | 各セクションコンポーネントの枠を作成し配置。 |
| 3 | コンポーネント実装（個別） | 各コンポーネントに HTML 構造を JSX として移植。CSS Modules でスタイリング。必要に応じて `"use client"` を付与。 |

### 5.4 フェーズ4: 移行完了・アーカイブ

| # | タスク | 詳細 |
|---|--------|------|
| 1 | ステークホルダーへ周知 | 新ルールとリポジトリ URL を案内 |
| 2 | 旧リポジトリ（nico_demo）の凍結 | Release 作成（例: `v1.0.0-final`）→ README 更新 → アーカイブ設定 |
| 3 | README の案内更新 | 冒頭に「本番用リポジトリの URL」「今後の更新場所」「問い合わせ先」を明記 |

---

## 6. 移行後の運用

### 6.1 運用ルール（概要）

- **ブランチ戦略**: GitHub Flow（`main` は保護。直 push 禁止、必須レビュー 1、CI 必須）
- **権限**: 本番リポジトリは Private。外部共有は Releases の成果物のみ
- **PR**: 小さく分割、CI グリーンでマージ。大きい PR は分割
- **秘密情報**: `.env` はコミット禁止。GitHub Secrets で管理
- **リリース**: タグ `vX.Y.Z`、`CHANGELOG.md` 更新必須
- **緊急対応**: `hotfix/*` → レビュー後に `main` へ
- **ドキュメント更新**: 本方針の変更は PR 提出 → オーナー承認

### 6.2 アーカイブ（凍結）の具体手順

1. 最終スナップショットを作成  
   Release を作成（例: `v1.0.0-final`）し、現状をタグとして固定
2. README の案内を更新  
   冒頭に「本番用リポジトリの URL」「今後の更新場所」「問い合わせ先」を明記
3. ブランチ保護の再確認  
   `main` 直 push 禁止、必須レビュー、CI 必須を設定
4. GitHub でアーカイブ設定  
   `Settings` → `General` → `Danger Zone` → `Archive this repository`
5. オプションの整理  
   Issues/Wiki/Projects などを閉じ、説明文に「アーカイブ済み・参照専用」を追記

### 6.3 凍結後にできること・できないこと

- **できること**: 閲覧、クローン、フォーク、過去履歴の参照
- **できないこと**: 新しい Issue や PR の作成、Push、マージ、（多くの）設定変更
- **注意**: 変更が必要になった場合は、一時的に「Unarchive」してから対応

---

## 参考：元ドキュメントの対応表

| この計画書のセクション | 参照元 |
|------------------------|--------|
| 1. プロジェクト概要 | `プロジェクトサマリー.md` |
| 2. 移行の全体像 | `プロジェクトサマリー.md`, `repository_management_plan.md` |
| 3. リポジトリ管理方針 | `移行用リポジトリ.md`, `repository_management_plan.md` |
| 4. Next.js 技術設計 | `spec/nextjs.md` |
| 5. 移行実施手順 | `spec/nextjs.md`, `repository_management_plan.md` |
| 6. 移行後の運用 | `repository_management_plan.md` |
